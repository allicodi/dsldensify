% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utils.R
\name{run_grid_setting}
\alias{run_grid_setting}
\title{Run cross-validation routine for a single discretization (grid) setting}
\usage{
run_grid_setting(
  grid_type,
  n_bins,
  A,
  W,
  wts,
  cv_folds_id,
  id_fold,
  ids_full = NULL,
  learners,
  return_fits = TRUE,
  return_density = FALSE,
  eps = 1e-15,
  ...
)
}
\arguments{
\item{grid_type}{Character string specifying the discretization strategy
(e.g., \code{"equal_range"} or \code{"equal_mass"}).}

\item{n_bins}{Integer number of bins used for discretization.}

\item{A}{Numeric vector of exposure or time variable.}

\item{W}{Matrix or data frame of covariates.}

\item{wts}{Numeric vector of observation weights.}

\item{cv_folds_id}{List of cross-validation fold objects. Each element must
contain a `validation_set` of observation indices.}

\item{id_fold}{Integer vector mapping observation IDs to fold numbers.}

\item{learners}{Named list of learner runner objects. Each runner must implement
\code{fit(train_set)} and \code{predict(fit, newdata)} methods, and may include a
\code{tune_grid}.}

\item{return_fits}{Logical; if \code{TRUE}, fitted learner objects are returned.}

\item{return_density}{Logical; if \code{TRUE}, estimated densities (mass / bin width)
are returned for validation observations.}

\item{...}{Additional arguments (currently unused).}
}
\value{
A list with components:
  \describe{
    \item{cv_out}{A list of length \code{V} (number of folds). Each element contains
      fold-level results including \code{fold_weight} and per-learner loss vectors.}
    \item{breaks}{Vector of bin breakpoints used for discretization.}
    \item{bin_length}{Vector of bin widths corresponding to \code{breaks}.}
    \item{grid_type}{The discretization type used.}
    \item{n_bins}{Number of bins used.}
  }
}
\description{
Fits and evaluates a set of hazard-based learners under a fixed discretization
scheme (defined by \code{grid_type} and \code{n_bins}) using cross-validation. For each
fold, learners are trained on long-format hazard data, predicted on validation
data, converted to per-observation mass, and scored via negative log loss.
}
\details{
Internally, the function:
\enumerate{
  \item Converts \code{(A, W)} into long-format hazard data via \code{format_long_hazards()}.
  \item Splits the long data by fold while preserving observation-level grouping.
  \item Fits each learner on training hazards and predicts hazards on validation data.
  \item Aggregates hazards to per-observation mass using
  \code{hazards_to_mass_by_obs()}.
  \item Computes weighted negative log loss using \code{neg_logloss()}.
}
}
