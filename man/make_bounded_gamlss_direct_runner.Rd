% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/runner_direct_bounded_gamlss.R
\name{make_bounded_gamlss_direct_runner}
\alias{make_bounded_gamlss_direct_runner}
\title{Create a GAMLSS beta runner for bounded outcomes using an affine transform}
\usage{
make_bounded_gamlss_direct_runner(
  mu_rhs_list,
  sigma_rhs_list = c("1"),
  lower,
  upper,
  use_weights_col = TRUE,
  strip_fit = TRUE,
  control = gamlss::gamlss.control(n.cyc = 50, trace = FALSE),
  eps = 1e-12,
  eps_fit = 1e-06,
  fallback = c("beta_glm", "none"),
  ...
)
}
\arguments{
\item{mu_rhs_list}{RHS specifications for the location parameter mu. May be
one-sided formulas (for example, ~ W1 + W2) or character strings
(for example, "W1 + W2"). Must have length at least 1.}

\item{sigma_rhs_list}{RHS specifications for the scale parameter sigma.
Defaults to "1". May be formulas or character strings.}

\item{lower}{Known lower bound for A (finite numeric scalar).}

\item{upper}{Known upper bound for A (finite numeric scalar), must satisfy upper > lower.}

\item{use_weights_col}{Logical. If TRUE and the training data contain a column
named wts, it is passed to gamlss::gamlss() via weights. Otherwise, fitting
is unweighted.}

\item{strip_fit}{Logical. If TRUE, strip fitted gamlss objects before storing them.}

\item{control}{A gamlss.control() object controlling the fitting procedure.}

\item{eps}{Small positive constant used for clipping transformed values away from
0 and 1, and for bounding log-densities away from -Inf.}

\item{eps_fit}{Small positive constant used for clipping transformed values during
fitting. Larger than eps is often more stable. Defaults to 1e-6.}

\item{fallback}{Character string specifying fallback behavior when a GAMLSS fit fails.
One of "beta_glm" or "none".}

\item{...}{Additional arguments forwarded to gamlss::gamlss().}
}
\value{
A named list (runner) with elements:
  method: Character string "gamlss_beta".
  tune_grid: Data frame enumerating mu_rhs / sigma_rhs combinations, including .tune.
  fit: Function fit(train_set, ...) returning a fit bundle containing all fits.
  log_density: Function log_density(fit_bundle, newdata, ...) returning an n x K
    matrix of log-densities for A | W.
  density: Function density(fit_bundle, newdata, ...) returning densities on the
    original scale for A | W.
  fit_one: Function fit_one(train_set, tune, ...) fitting only the selected tuning index.
  select_fit: Function select_fit(fit_bundle, tune) extracting a single tuning configuration.
  sample: Function sample(fit_bundle, newdata, n_samp, ...) drawing samples from the
    implied A | W distribution (assumes length(fit_bundle$fits) == 1).

Data requirements

The runner expects train_set and newdata in wide format containing:
  - a numeric outcome column A,
  - covariates referenced in the RHS specifications,
  - an optional weight column wts.
}
\description{
Constructs a runner (learner adapter) compatible with the dsldensify() /
summarize_and_select() workflow for direct conditional density estimation of a
bounded continuous outcome A given covariates W.
}
\details{
This runner assumes A lies in known bounds (lower, upper) and models a
transformed outcome Y in (0, 1) using a Beta family in GAMLSS. The transform is:
  Y = (A - lower) / (upper - lower)
After fitting a Beta model for Y | W, the implied conditional density for A | W
is obtained via a change of variables:
  f_A(a | W) = f_Y(y | W) / (upper - lower),
where y is the transformed value corresponding to a.

The runner supports tuning over formulas for the location parameter (mu) and
optionally the scale parameter (sigma) of the Beta family.

Robustness and fallback behavior

GAMLSS fits can fail to converge or error for some folds or formula choices.
This runner supports an optional fallback:
  - fallback = "beta_glm": if a GAMLSS fit fails, fall back to a mean model for
    Y using a (quasi)binomial GLM with logit link, and estimate a single global
    precision parameter phi for the Beta distribution using a method-of-moments
    style estimate based on weighted residual variance.
  - fallback = "none": failed fits return log(eps) in log_density() and NA samples.

Numeric-only requirement

This runner assumes all covariates referenced in RHS formulas are numeric.
Factors and character predictors are not supported.

Tuning grid and prediction layout

The internal tune_grid is the Cartesian product of mu_rhs_list and sigma_rhs_list.
Each row corresponds to a distinct GAMLSS specification. During cross-validation,
log_density() returns an n x K matrix of log-densities aligned to .tune.

Sampling from the fitted direct density model

The runner provides a sample() method that generates draws A* ~ f_hat(Â· | W).
Sampling assumes the fit_bundle contains exactly one tuned fit
(length(fit_bundle$fits) == 1). It expects newdata in wide format containing only W
and returns an nrow(newdata) x n_samp numeric matrix.

Lightweight fit objects

When strip_fit = TRUE, fitted gamlss objects are stripped of large components
(responses, fitted values, residuals) before storage, reducing memory usage.
}
\examples{
mu_rhs <- list(~ x1 + x2, ~ x1)
runner <- make_gamlss_beta_bounded_runner(
  mu_rhs_list = mu_rhs,
  sigma_rhs_list = c("1", "~ x1"),
  lower = -5,
  upper = 5,
  fallback = "beta_glm"
)

}
